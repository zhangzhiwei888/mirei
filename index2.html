
                        <!DOCTYPE html>
                        <html lang="en">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
							<style>
								body {
									background-color: white; /* Ensure the iframe has a white background */
								}

								
body, html {
    margin: 0;
    height: 100%;
    overflow: hidden;
    background: black;
    color: white;
    font-family: sans-serif;
}
#video, #previewImage {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}
#ui {
    position: absolute;
    top: 10px; left: 10px;
    background: rgba(0,0,0,0.5);
    padding: 10px;
    border-radius: 6px;
    z-index: 10;
}
#flash {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: white;
    opacity: 0;
    pointer-events: none;
    z-index: 20;
}
button {
    font-size: 16px;
    padding: 8px 16px;
    margin: 5px;
}
#previewOverlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;
    z-index: 30;
}
#previewButtons {
    background: rgba(0,0,0,0.5);
    padding: 20px;
    width: 100%;
    display: flex;
    justify-content: space-around;
}


							</style>
                        </head>
                        <body>
                            <!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>ç±³ç‘å©šçº±ç¤¼æœé€‰å®šè¡¨ - å…¨å±æ‹ç…§ç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
body, html {
    margin: 0;
    height: 100%;
    overflow: hidden;
    background: black;
    color: white;
    font-family: sans-serif;
}
#video, #previewImage {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}
#ui {
    position: absolute;
    top: 10px; left: 10px;
    background: rgba(0,0,0,0.5);
    padding: 10px;
    border-radius: 6px;
    z-index: 10;
}
#flash {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: white;
    opacity: 0;
    pointer-events: none;
    z-index: 20;
}
button {
    font-size: 16px;
    padding: 8px 16px;
    margin: 5px;
}
#previewOverlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;
    z-index: 30;
}
#previewButtons {
    background: rgba(0,0,0,0.5);
    padding: 20px;
    width: 100%;
    display: flex;
    justify-content: space-around;
}
</style>
<!-- åŠ è½½Excelå’Œä¸‹è½½åº“ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>

<!-- æ‘„åƒå¤´ç”»é¢ -->
<video id="video" autoplay playsinline></video>
<img id="previewImage" style="display:none;">
<div id="flash"></div>

<!-- é¡¶éƒ¨æ§åˆ¶UI -->
<div id="ui">
    <div>
        å©šç¤¼æ—¥æœŸï¼š<input type="date" id="weddingDate">
    </div>
    <div>
        ç¤¼æœæ¬¾å¼ï¼š<input type="text" id="remark" placeholder="è¾“å…¥ç¤¼æœæ¬¾å¼">
    </div>
    <button id="export">å¯¼å‡ºExcel</button>
    <p>ğŸ“· ç‚¹å‡»å±å¹•ä»»æ„ä½ç½®æ‹ç…§</p>
</div>

<!-- é¢„è§ˆå±‚ -->
<div id="previewOverlay">
    <div id="previewButtons">
        <button id="keepPhoto" style="background-color:green;color:white;">ä¿ç•™</button>
        <button id="discardPhoto" style="background-color:red;color:white;">åˆ é™¤</button>
    </div>
</div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
let photos = [];
let weddingDateCache = null;
let pendingPhoto = null;

// å¯åŠ¨æ‘„åƒå¤´
async function startCamera() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "environment" },
            audio: false
        });
        document.getElementById('video').srcObject = stream;
    } catch (err) {
        alert("æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸è®¿é—®æ‘„åƒå¤´ã€‚");
    }
}
startCamera();

// é—ªå±åŠ¨ç”»
function flashScreen() {
    const flash = document.getElementById('flash');
    flash.style.opacity = 1;
    setTimeout(() => flash.style.opacity = 0, 100);
}

// ç‚¹å‡»å±å¹•æ‹ç…§
document.body.addEventListener('click', (e) => {
    if (e.target.closest('#ui') || e.target.closest('#previewButtons')) return;

    if (!weddingDateCache) {
        const inputDate = document.getElementById('weddingDate').value;
        if (!inputDate) {
            alert("è¯·å…ˆé€‰æ‹©å©šç¤¼æ—¥æœŸï¼");
            return;
        }
        weddingDateCache = inputDate;
        document.getElementById('weddingDate').disabled = true;
    }

    const remark = document.getElementById('remark').value || "ï¼ˆæ— å¤‡æ³¨ï¼‰";
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const imageDataURL = canvas.toDataURL("image/png");
    const base64Data = imageDataURL.split(",")[1];

    const now = new Date();
    const timestamp = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;

    // æš‚å­˜ç…§ç‰‡å¾…ç¡®è®¤
    pendingPhoto = {
        img: base64Data,
        remark: remark,
        time: timestamp,
        weddingDate: weddingDateCache
    };

    // æ˜¾ç¤ºé¢„è§ˆ
    document.getElementById('previewImage').src = imageDataURL;
    document.getElementById('previewImage').style.display = 'block';
    document.getElementById('video').style.display = 'none';
    document.getElementById('previewOverlay').style.display = 'flex';

    flashScreen();
});

// ä¿ç•™ç…§ç‰‡
document.getElementById('keepPhoto').addEventListener('click', () => {
    if (pendingPhoto) {
        photos.push(pendingPhoto);
        alert(`å·²ä¿å­˜ ${photos.length} å¼ ç…§ç‰‡`);
    }
    closePreview();
});

// åˆ é™¤ç…§ç‰‡
document.getElementById('discardPhoto').addEventListener('click', () => {
    alert("ç…§ç‰‡å·²åˆ é™¤");
    closePreview();
});

// å…³é—­é¢„è§ˆ
function closePreview() {
    document.getElementById('previewImage').style.display = 'none';
    document.getElementById('video').style.display = 'block';
    document.getElementById('previewOverlay').style.display = 'none';
    document.getElementById('remark').value = '';
    pendingPhoto = null;
}

// å¯¼å‡º Excel
document.getElementById('export').addEventListener('click', async () => {
    if (photos.length === 0) {
        alert("è¯·å…ˆæ‹æ‘„å¹¶ä¿ç•™è‡³å°‘ä¸€å¼ ç…§ç‰‡ï¼");
        return;
    }

    const workbook = new ExcelJS.Workbook();
    const worksheet = workbook.addWorksheet("ç±³ç‘å©šçº±ç¤¼æœé€‰å®šè¡¨");

    worksheet.getCell("A1").value = "å©šç¤¼æ—¥æœŸ";
    worksheet.getCell("B1").value = "ç¤¼æœæ¬¾å¼";
    worksheet.getCell("C1").value = "æ‹æ‘„æ—¶é—´";
    worksheet.getCell("D1").value = "ç…§ç‰‡";

    worksheet.getColumn(1).width = 15; 
    worksheet.getColumn(2).width = 40; 
    worksheet.getColumn(3).width = 25; 
    worksheet.getColumn(4).width = 50; 

    let rowPos = 2;
    photos.forEach((item) => {
        worksheet.getCell(`A${rowPos}`).value = item.weddingDate;
        worksheet.getCell(`B${rowPos}`).value = item.remark;
        worksheet.getCell(`C${rowPos}`).value = item.time;

        const imageId = workbook.addImage({
            base64: `data:image/png;base64,${item.img}`,
            extension: 'png',
        });
        worksheet.addImage(imageId, {
            tl: { col: 3, row: rowPos - 1 },
            ext: { width: 320, height: 240 }
        });
        rowPos += 15;
    });

    const buffer = await workbook.xlsx.writeBuffer();
    const blob = new Blob([buffer], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" });
    const safeDate = (weddingDateCache || "æœªå¡«å†™").replace(/-/g, "");
    saveAs(blob, `ç±³ç‘å©šçº±ç¤¼æœé€‰å®šè¡¨-${safeDate}.xlsx`);
});
</script>
</body>
</html>



							<script>
                            	
let photos = [];
let weddingDateCache = null;
let pendingPhoto = null;

// å¯åŠ¨æ‘„åƒå¤´
async function startCamera() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "environment" },
            audio: false
        });
        document.getElementById('video').srcObject = stream;
    } catch (err) {
        alert("æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸è®¿é—®æ‘„åƒå¤´ã€‚");
    }
}
startCamera();

// é—ªå±åŠ¨ç”»
function flashScreen() {
    const flash = document.getElementById('flash');
    flash.style.opacity = 1;
    setTimeout(() => flash.style.opacity = 0, 100);
}

// ç‚¹å‡»å±å¹•æ‹ç…§
document.body.addEventListener('click', (e) => {
    if (e.target.closest('#ui') || e.target.closest('#previewButtons')) return;

    if (!weddingDateCache) {
        const inputDate = document.getElementById('weddingDate').value;
        if (!inputDate) {
            alert("è¯·å…ˆé€‰æ‹©å©šç¤¼æ—¥æœŸï¼");
            return;
        }
        weddingDateCache = inputDate;
        document.getElementById('weddingDate').disabled = true;
    }

    const remark = document.getElementById('remark').value || "ï¼ˆæ— å¤‡æ³¨ï¼‰";
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const imageDataURL = canvas.toDataURL("image/png");
    const base64Data = imageDataURL.split(",")[1];

    const now = new Date();
    const timestamp = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;

    // æš‚å­˜ç…§ç‰‡å¾…ç¡®è®¤
    pendingPhoto = {
        img: base64Data,
        remark: remark,
        time: timestamp,
        weddingDate: weddingDateCache
    };

    // æ˜¾ç¤ºé¢„è§ˆ
    document.getElementById('previewImage').src = imageDataURL;
    document.getElementById('previewImage').style.display = 'block';
    document.getElementById('video').style.display = 'none';
    document.getElementById('previewOverlay').style.display = 'flex';

    flashScreen();
});

// ä¿ç•™ç…§ç‰‡
document.getElementById('keepPhoto').addEventListener('click', () => {
    if (pendingPhoto) {
        photos.push(pendingPhoto);
        alert(`å·²ä¿å­˜ ${photos.length} å¼ ç…§ç‰‡`);
    }
    closePreview();
});

// åˆ é™¤ç…§ç‰‡
document.getElementById('discardPhoto').addEventListener('click', () => {
    alert("ç…§ç‰‡å·²åˆ é™¤");
    closePreview();
});

// å…³é—­é¢„è§ˆ
function closePreview() {
    document.getElementById('previewImage').style.display = 'none';
    document.getElementById('video').style.display = 'block';
    document.getElementById('previewOverlay').style.display = 'none';
    document.getElementById('remark').value = '';
    pendingPhoto = null;
}

// å¯¼å‡º Excel
document.getElementById('export').addEventListener('click', async () => {
    if (photos.length === 0) {
        alert("è¯·å…ˆæ‹æ‘„å¹¶ä¿ç•™è‡³å°‘ä¸€å¼ ç…§ç‰‡ï¼");
        return;
    }

    const workbook = new ExcelJS.Workbook();
    const worksheet = workbook.addWorksheet("ç±³ç‘å©šçº±ç¤¼æœé€‰å®šè¡¨");

    worksheet.getCell("A1").value = "å©šç¤¼æ—¥æœŸ";
    worksheet.getCell("B1").value = "ç¤¼æœæ¬¾å¼";
    worksheet.getCell("C1").value = "æ‹æ‘„æ—¶é—´";
    worksheet.getCell("D1").value = "ç…§ç‰‡";

    worksheet.getColumn(1).width = 15; 
    worksheet.getColumn(2).width = 40; 
    worksheet.getColumn(3).width = 25; 
    worksheet.getColumn(4).width = 50; 

    let rowPos = 2;
    photos.forEach((item) => {
        worksheet.getCell(`A${rowPos}`).value = item.weddingDate;
        worksheet.getCell(`B${rowPos}`).value = item.remark;
        worksheet.getCell(`C${rowPos}`).value = item.time;

        const imageId = workbook.addImage({
            base64: `data:image/png;base64,${item.img}`,
            extension: 'png',
        });
        worksheet.addImage(imageId, {
            tl: { col: 3, row: rowPos - 1 },
            ext: { width: 320, height: 240 }
        });
        rowPos += 15;
    });

    const buffer = await workbook.xlsx.writeBuffer();
    const blob = new Blob([buffer], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" });
    const safeDate = (weddingDateCache || "æœªå¡«å†™").replace(/-/g, "");
    saveAs(blob, `ç±³ç‘å©šçº±ç¤¼æœé€‰å®šè¡¨-${safeDate}.xlsx`);
});


							</script>
                        </body>
                        </html>
                    